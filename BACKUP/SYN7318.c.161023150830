#include "USART.h"
#include "basic.c"

//数据帧_待发送文本
uchar text[100];
//发送帧，0帧头，1数据区长度高字节，2数据区长度低字节，3命令字，4编码格式
extern uchar TxCharBuf[128];
extern uchar TxStrLen;


/*******************************************************************************
* SYN语音识别模块_初始化
********************************************************************************/
void SYN7318_init(void)
{
    //PE6,7 定义输出 10ms低电平 延时100ms
    ...
    //自定义语音唤醒名
    ...
    //设置识别参数，识别距离等
    ...
}

/*******************************************************************************
* 语音播报
********************************************************************************/
void voicePlayer(uchar *content)
{
    uchar length = strlen(content); //待发送文本长度
    TxCharBuf[0] = 0xFD;  //构造帧头
    TxCharBuf[1] = 0x00;  //构造数据区长度的高字节
    TxCharBuf[2] = length + 2; //构造数据区长度的低字节
    TxCharBuf[3] = 0x01;  //构造命令字：合成播放命令
    TxCharBuf[4] = 0x00;  //构造命令参数：编码格式为GB2312
    for(int i = 0; i < length; i++){    //构造待发送文本
        TxCharBuf[5+i] = content[i]; 
    }

    TxStrLen = strlen(TxCharBuf);   //整个帧的长度
	puts0();                        //串口0发送数据
    delay_nms(20);                  //延时20ms，帧与帧之间必须间隔超过15ms
}

/*******************************************************************************
* 语音播报欢迎信息
********************************************************************************/
void SYN7318_welcome(void)
{
    sprintf(text,"欢迎使用");
    voicePlayer(text);
}